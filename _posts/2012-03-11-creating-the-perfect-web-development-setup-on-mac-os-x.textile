---
layout: post
title: "Creating the perfect web development setup on Mac OS X"
---

I'm always busy developing, therefor I find it importing that setting up a new project and deploying code should be a breeze. As soon as I create a folder @bootstrap@, for example - I could just visit @http://bootstrap.local/@. That's it. I'm using Apache, PHP and MySQL, downloaded from Macports. My custom DNS setup which supplies a wildcard @*.local@ domain is Bind, also from Macports.

To accomplish roughly the same thing, you'll need the following:

* Two cups of coffee
* Mac OS X Lion, at least
* XCode or the "OS X Development Tools":https://developer.apple.com/downloads/index.action
* The latest version of MacPorts
* Optionally: "Sequel Pro":http://www.sequelpro.com/

h3. Step 1: Installing Apache 2 and PHP 5


<h2>Stap 1: Installatie van Apache 2 en PHP 5</h2>
Ik vertrouw er op dat je als getalenteerde programmeur bekend bent met de terminal uit OS X. Goed, open deze maar. Voer het onderstaande commando uit:
<pre>sudo port install php5 +apache2</pre>
Dit kan wel even duren bij een schone installatie van MacPorts. Kopieer vervolgens het juiste PHP configuratie bestand uit <code>/opt/local/etc/php/</code> naar <code>/opt/local/etc/php/php.ini</code>. Ik ben gegaan voor de <em>development</em> versie. Activeer vervolgens de PHP module in de configuratie van Apache:
<pre>cd /opt/local/apache2/modules
sudo /opt/local/apache2/bin/apxs -a -e -n "php5" libphp5.so</pre>
Deze PHP modules wil je ook, absoluut:
<pre>sudo port install php5-apc php5-curl php5-gd php5-iconv php5-imagick imagemagick php5-intl php5-mcrypt php5-mysql php5-openssl php5-xdebug</pre>
Ik vind het fijn om de hoofd map van de Apache server gelijk te houden aan de standaard variant op Mac OS X. Dit is dus <code>/Library/WebServer/Documents</code>. Open <code>/opt/local/apache2/conf/httpd.conf</code> en pas de volgende dingen aan:
<pre># LoadModule vhost_alias_module modules/mod_vhost_alias.so</pre>
naar
<pre>LoadModule vhost_alias_module modules/mod_vhost_alias.so</pre>
Pas de DocumentRoot aan naar:
<pre>DocumentRoot "/Library/WebServer/Documents"</pre>
Pas een paar regels later ook het &lt;Directory&gt; blok aan:
<pre>&lt;Directory "/Library/WebServer/Documents"&gt;</pre>
Voeg de PHP extensie toe aan DirectoryIndex:
<pre>DirectoryIndex index.html index.php</pre>
Voeg deze twee regels toe aan het blok <code>&lt;IfModule mime_module&gt;</code>:
<pre>AddType application/x-httpd-php .php
AddType application/x-httpd-php-source .phps</pre>
Voor het gemak, voeg deze regel toe aan <code>~/.profile</code>:
<pre>alias apache2ctl='sudo /opt/local/apache2/bin/apachectl'</pre>
Herstart vervolgens de webserver met <code>apache2ctl restart</code>.

Indien je wilt dat Apache voortaan standaard opstart bij het aanzetten van je Mac, voer het volgende commando uit:
<pre>sudo port load apache2</pre>
<h3>Klaar. De test.</h3>
Zet de rechten goed op deze map en voeg een PHP info test bestand toe:
<pre>chown -R `whoami` /Library/WebServer/Documents
echo '&lt;?php phpinfo(); ?&gt;' &gt; /Library/WebServer/Documents/phpinfo.php</pre>
Een bezoek aan <a href="http://localhost/phpinfo.php" target="_blank">http://localhost/phpinfo.php</a> toont nu het volgende:

<a href="http://jorijn.com/wp-content/uploads/2012/03/Screen-Shot-2012-03-11-at-1.00.29-PM.png"><img class="aligncenter size-full wp-image-202" title="Screen Shot 2012-03-11 at 1.00.29 PM" alt="" src="http://jorijn.com/wp-content/uploads/2012/03/Screen-Shot-2012-03-11-at-1.00.29-PM.png" width="609" height="241" /></a>
<h2>Stap 2: MySQL</h2>
Installeer de MySQL server uit MacPorts:
<pre>sudo port install mysql5 +server</pre>
Als dit klaar is, start de server en init de standaard database:
<pre>sudo port load mysql5
sudo -u _mysql /opt/local/bin/mysql_install_db5</pre>
Standaard heb je nu een installatie zonder beveiliging, iedereen kan er in met de <strong>root</strong> gebruiker zonder wachtwoord. Breng hier verandering in met:
<pre>sudo /opt/local/bin/mysql_secure_installation5</pre>
Je kan de werking van de nieuwe MySQL server controleren met:
<pre>macbook:~ jorijn$ mysqladmin5 -u root -p ping
Enter password:
mysqld is alive</pre>
Zet vervolgens de MySQL socket locatie goed in de PHP configuratie:
<pre>macbook:~ jorijn$ grep -i 'mysqld.sock' /opt/local/etc/php5/php.ini
pdo_mysql.default_socket=/opt/local/var/run/mysql5/mysqld.sock
mysql.default_socket =/opt/local/var/run/mysql5/mysqld.sock
mysqli.default_socket =/opt/local/var/run/mysql5/mysqld.sock</pre>
Klaar? Herstart de webserver met <code>apache2ctl restart</code>
<h2>Stap 3: Het instellen van de Apache virtuele hosts</h2>
Op dit punt heb je een installatie draaien met Apache 2, PHP 5 en MySQL 5. Ik neem het een stap verder, iedere web developer werkt aan projecten, het is veel gedoe om iedere keer een virtuele host aan te maken voor ieder project. Open <code>/opt/local/apache2/conf/httpd.conf</code> en verander:
<pre># Include conf/extra/httpd-vhosts.conf</pre>
naar
<pre>Include conf/extra/httpd-vhosts.conf</pre>
Open daarna <code>/opt/local/apache2/conf/extra/httpd-vhosts.conf</code> en vervang de gehele inhoud met:
<pre>NameVirtualHost *:80

&lt;VirtualHost *:80&gt;
   ServerAlias *.local

   UseCanonicalName Off
   VirtualDocumentRoot /Library/WebServer/Documents/%-2/

   php_admin_value auto_prepend_file /Library/WebServer/Documents/set_document_root.php
&lt;/VirtualHost&gt;</pre>
Zodra je gebruik gaat maken van <code>VirtualDocumentRoot</code> werkt de server variabele <code>DOCUMENT_ROOT</code> niet meer. Dit heb ik opgelost met het bestand <code>set_document_root.php</code>. Open <code>/Library/WebServer/Documents/set_document_root.php</code> en zet daar het volgende in:
<pre>&lt;?php

$subdomain = explode('.', $_SERVER['HTTP_HOST']);
$subdomain = array_reverse($subdomain);
$subdomain = $subdomain[1];

$_SERVER['DOCUMENT_ROOT'] = __DIR__ . '/' . $subdomain . '/';

?&gt;</pre>
<h3>Wat nu?</h3>
Nu heb je (na het herstarten van je webserver) een situatie waar als je naar bijvoorbeeld <strong>test_project.local</strong> gaat, de document root gezet wordt naar <code>/Library/WebServer/Documents/test_project/</code>. Het probleem waar je nu tegen aan loopt is dat <strong>test_project.local</strong> geen geldig domein is, hiervoor hebben we een DNS server nodig.
<h2>Stap 4: Installatie van Bind</h2>
Installeer de Bind DNS server met:
<pre>sudo port install bind9</pre>
Download <a href="http://jorijn.com/wp-content/uploads/2012/03/named.txt">named.conf</a> en plaats deze in <code>/opt/local/etc/named.conf</code>. Download ook de zones <a href="http://jorijn.com/wp-content/uploads/2012/03/db.127.0.0.txt" target="_blank">db.127.0.0</a>, <a href="http://jorijn.com/wp-content/uploads/2012/03/db.cache.txt" target="_blank">db.cache</a>, <a href="http://jorijn.com/wp-content/uploads/2012/03/db.local.txt" target="_blank">db.local</a> en <a href="http://jorijn.com/wp-content/uploads/2012/03/db.localhost.txt" target="_blank">db.localhost</a> en plaats deze in /opt/local/var/named/. Vergeet niet de <strong>txt</strong> extensie weg te halen. Start de DNS server met:
<pre>sudo port load bind9</pre>
Test de nieuwe server met:
<pre>macbook:~ jorijn$ host test_project.local 127.0.0.1
Using domain server:
Name: 127.0.0.1
Address: 127.0.0.1#53
Aliases:

test_project.local has address 127.0.0.1</pre>
en
<pre>macbook:~ jorijn$ host google.nl 127.0.0.1
Using domain server:
Name: 127.0.0.1
Address: 127.0.0.1#53
Aliases:

google.nl has address 173.194.65.94
google.nl mail is handled by 10 google.com.s9a1.psmtp.com.
google.nl mail is handled by 10 google.com.s9a2.psmtp.com.
google.nl mail is handled by 10 google.com.s9b1.psmtp.com.
google.nl mail is handled by 10 google.com.s9b2.psmtp.com.</pre>
Als dit werkt kun je in je netwerk instellingen <strong>127.0.0.1</strong> als DNS server toevoegen. Vanaf nu kun je ook <strong>test_project.local</strong> benaderen vanuit je web browser.
<h2>Conclusie</h2>
Met deze omgeving kun je snel projecten toevoegen en verwijderen zonder iedere keer te moeten rommelen in configuratie bestanden. Ben ik iets vergeten of werkt er iets niet naar behoren? Laat een bericht achter in de reacties en ik zal kijken of ik je hier mee kan helpen.
